version: 2.1
orbs: 
  kubernetes: circleci/kubernetes@1.3.0

workflows:
  testing:
    jobs:
      - runner-test:
          context: kaniko
#      - runner-test-1
#      - runner-test-2

jobs:
  runner-test:
    machine: true
    resource_class: abeyuki/circleci
 #   docker:
 #     - image: cimg/base:2021.11
 #       auth:
 #         username: abeyuki
 #         password: $DOCKERHUB_PASSWORD
    steps:
      - run: 
          name: "KUBECONFIG"
          command: |
            echo 'export PATH=/path/to/foo/bin:$PATH' >> $BASH_ENV
            echo 'export VERY_IMPORTANT=$(cat important_value)' >> $BASH_ENV
            source $BASH_ENV
            echo ${KUECONFIG}
#  runner-test-1:
#    docker:
#      - image: 'cimg/base:stable'
#    steps:
#      - checkout
#      - kubernetes/install-kubectl
#      - kubernetes/create-or-update-resource:
#          get-rollout-status: true
#          resource-file-path: tests/nginx-deployment/deployment.yaml
#          resource-name: deployment/nginx-deployment
#          show-kubectl-command: true